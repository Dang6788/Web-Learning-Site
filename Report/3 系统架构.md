# 系统架构

## 概述

尽管我们的网站应用较为简单，我们仍然希望在云服务器上实现较为完备的Web Server框架。我们最终决定采用Nginx + uWSGI+ Flask的系统架构。当用户通过浏览器提交http请求，Web Server会获取这一请求，并交给响应的应用程序进行处理，应用程序处理完成后将结果返回给Web Server，并由Web Server返回给用户，用户便能够获取并浏览相应的网页。而Web Server与应用程序之间的交互，需要遵循一定的规范，也就是“接口”。现有的规范包括CGI、FasgCGI、Java Servlet、以及WSGI（Web Server Gateway Interface）等。

![输入图片说明](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zdGF0aWMub3NjaGluYS5uZXQvdXBsb2Fkcy9pbWcvMjAxNzAzLzMwMTM1MTQ2X3l2M1YucG5n)

在应用程序层，我们采用Python的Flask框架，在Web Server层，我们采用Nginx + uWSGI，二者虽然都能起到Web Server的作用，但Nginx是一个提供静态文件访问（例如访问html）的Web服务，并不能直接托管Python程序，而需要通过WSGI提供的接口进行连接。其中uWSGI中就实现了WSGI、uwsgi、http等协议。



## Nginx层

目前主流的Web Server架构包括Nginx、Apache等，我们采用Nginx，主要是考虑到Nginx能够实现负载均衡、具有支持高并发的有点——比如学生抢课，且部署较为简便。且Nginx支持uWSGI的uwsgi协议，能够通过uwsig_pass将动态请求交给uWSGI处理。



如前所述，Web Server的作用为接收请求、与应用程序进行交互、返回响应。在C/S(Client/Server)架构中，Web服务器与客户端（的浏览器）之间基于HTTP协议进行数据传递。在服务器安装并运行Nginx后，能够通过IP地址访问Web服务器，可以看到Nginx默认路径下的静态页面。对该静态页面进行简单修改，即得到以下页面：[http://120.55.46.84](http://120.55.46.84/). 



## uWSGI层

如前所述，Nginx将动态请求通过uWSGI传递给Flask应用程序，Nginx与uWSGI之间则通过socket进行连接，工作原理如下图所示。uWSGI本质上也是能够实现WSGI协议的一种Web服务器。



![在这里插入图片描述](https://img-blog.csdn.net/20181008155327375?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbG92ZXhpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

（示例图 右侧Django应换成Flask）



安装uWSGI后，需要创建相应的配置文件使其与Nginx建立连接。配置文件中包括Python应用程序的路径、主程序文件名、socket端口等信息，在Flask框架中，```app = Flask(__name__)```作为uWSGI进行socket通信的端口。	



## 基于Flask的Python Web框架层

