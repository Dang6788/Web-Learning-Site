# 系统架构

## 概述

网站的实现使用阿里云ECS(Elastic Compute Service)服务器，使用的操作系统为centOS。我们首先在云服务器上部署Nginx Web Server，并在此基础上使用轻量级的Python Web框架Flask进行编程实践。要注意的是，Nginx是一个提供静态文件访问（例如访问html）的Web服务，并不能直接托管Python程序，而需要通过WSGI(Web Server Gateway Interface)提供的接口进行连接。

![输入图片说明](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zdGF0aWMub3NjaGluYS5uZXQvdXBsb2Fkcy9pbWcvMjAxNzAzLzMwMTM1MTQ2X3l2M1YucG5n)



## Web Server层

Web服务器的作用为接收请求、处理请求、返回响应。在C/S(Client/Server)架构中，Web服务器与客户端（的浏览器）之间基于HTTP协议进行数据传递。在服务器安装并运行Nginx后，能够通过IP地址访问Web服务器，可以看到Nginx默认路径下的静态页面。对该静态页面进行简单修改，即得到以下页面：[http://120.55.46.84](http://120.55.46.84/). 



### 阿里云ECS云服务器的端口设置

为对ECS云服务器的数据传输路径进行限制，阿里云规定了ECS云服务出方向、入方向的IP地址和端口限制。在出方向的默认IP地址为172.20.221.192，是ECS实例访问公网、私网、或ECS云服务器其他实例方向，入方向则相反。入方向的IP地址为申请该云服务器时分配的IP地址，本项目中为120.55.46.84. 若需要从公网经特定端口对云服务器中的资源进行访问，则首先在阿里云服务器官网进行设置，设置过程略。



在本项目的开发迭代过程中，我们为每一次在云服务器上的部署都添加了一个新的入方向端口，以回顾我们每一次迭代的改进，所有添加用于本项目的端口地址如下：

+ http://120.55.46.84:8080

+ http://120.55.46.84:8090

+ http://120.55.46.84:8100

+ http://120.55.46.84:8110

  （最后一次部署添加的端口地址）



需要注意的是，在Flask框架的主程序app.py中，需要将主函数中的```host```参数设为出方向IP地址，而端口则为入方向的端口地址，app.py的主函数如下：

```python
if __name__ == '__main__':
    app.run(host='172.20.221.192',port=8100,debug=True)
```



## WSGI层

Web Server能够尽能处理前端发来的静态请求，而将动态请求通过uWSGI传递给Flask框架，Nginx与uWSGI之间则通过socket进行连接，工作原理如下图所示。uWSGI本质上也是能够实现WSGI协议的一种Web服务器。



![在这里插入图片描述](https://img-blog.csdn.net/20181008155327375?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbG92ZXhpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

（示例图 右侧Django应换成Flask）



安装uWSGI后，需要创建相应的配置文件使其与Nginx建立连接，并由uWSGI Emperor读取云服务器上的配置文件并生成uWSGI进程来执行。配置文件中包括Python应用程序的路径、主程序文件名、socket端口等信息，在Flask框架中，```app = Flask(__name__)```作为uWSGI进行socket通信的端口。	



## 基于Flask的Python Web框架层

